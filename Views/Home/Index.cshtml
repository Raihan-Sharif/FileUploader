@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

<div id="drop-zone" class="drop-zone">
    Drop files here to upload
</div>

<div id="progress-bar" class="progress-bar" style="display: none;">
    <div class="progress-bar-fill"></div>
</div>

<form id="upload-form" >
    <input type="file" name="file" multiple>
    <button type="submit">Upload</button>
</form>

<script>
    const dropZone = document.getElementById('drop-zone');
    const progressBar = document.getElementById('progress-bar');
    const progressBarFill = progressBar.querySelector('.progress-bar-fill');
    const uploadForm = document.getElementById('upload-form');

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', e => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const files = Array.from(e.dataTransfer.files);
      handleFiles(files);
    });

    uploadForm.addEventListener('submit', e => {
      e.preventDefault();
      const files = Array.from(uploadForm.elements.file.files);
      handleFiles(files);
    });

    function handleFiles(files) {
      if (files.length === 0) return;

      progressBar.style.display = 'block';
      progressBarFill.style.width = '0%';

      const formData = new FormData();
      files.forEach(file => {
        formData.append('file', file);
      });

      fetch('/file/upload', {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        },
        onUploadProgress: progressEvent => {
          const progressPercent = (progressEvent.loaded / progressEvent.total) * 100;
          progressBarFill.style.width = `${progressPercent}%`;
        }
      })
      .then(response => response.json())
      .then(data => {
        progressBar.style.display = 'none';
        if (data.editUrl) {
          // Redirect to the image editing UI
          window.location.href = data.editUrl;
        } else {
          // Handle uploaded file
          console.log('Uploaded file:', data.filePath);
        }
      })
      .catch(error => {
        progressBar.style.display = 'none';
        console.error('Error uploading file:', error);
      });
    }
</script>

